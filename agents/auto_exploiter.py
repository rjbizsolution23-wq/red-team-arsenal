"""
ðŸ”´ðŸ’€ Auto Exploiter â€” High-speed autonomous exploit chain-firing
"""
import time
from typing import Dict, List, Any
from agents.base_agent import BaseAgent
from core.hive_mind import HiveMind

class AutoExploiter(BaseAgent):
    """
    An agent that reacts to HiveMind events (e.g., target_mapped)
    and chain-fires exploits from the ExploitFeed.
    """
    def __init__(self, hive_mind: HiveMind):
        super().__init__("auto_exploiter", "Infinite Exploit Engineer")
        self.hive_mind = hive_mind
        # Subscribe to new targets found by other agents
        self.hive_mind.subscribe("target_mapped", self._on_target_mapped)

    def _on_target_mapped(self, target_data: Dict):
        """React immediately when a target is mapped by the Recon agent."""
        self.log(f"Received mapped target from HiveMind: {target_data.get('host')}")
        self.execute({"target": target_data.get('host'), "services": target_data.get('services')}, {})

    def execute(self, task: Dict[str, Any], context: Dict[str, Any]) -> str:
        target = task.get("target")
        self.log(f"Chain-firing autonomous exploits against {target}...")
        
        # Simulate exploit chaining
        exploits = ["SQLi-to-RCE", "Kerberos-Relay", "PrintNightmare-LPE"]
        for exp in exploits:
            self.log(f"Firing {exp}...")
            time.sleep(1)
            
        # Post successful findings back to HiveMind
        self.hive_mind.post("exploit_success", {"target": target, "access": "SYSTEM", "method": "PrintNightmare"})
        
        return f"âœ… Autonomous exploit chain completed on {target}. Access: SYSTEM."
